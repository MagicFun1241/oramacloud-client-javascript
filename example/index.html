<html>
    <head>
        <title>Example</title>
    <body>

        <div>
            <label>
                <input type="text" id="endpoint" value="https://cloud.orama.foo/index/tommaso-test-2" />
                Endpoint
            </label>
        </div>
        <div>
            <label>
                <input type="text" id="apikey" value="foo" />
                API Key
            </label>
        </div>
        <div>
            <label>
                <input type="checkbox" id="withcache" value="withcache" />
                With cache
            </label>
        </div>
        <div>
            <label>
                <input type="checkbox" id="withtelemetry" checked value="withtelemetry" />
                With telemetry
            </label>
        </div>
        <div>
            <label>
                <input type="checkbox" id="withheartbeat" checked value="withheartbeat" />
                With HeartBeat
            </label>
        </div>
        <button id="create">Create</button>

        <div id="instance" style="display: none;">
            <input type="text" name="term" id="term" placeholder="search as you type"/>
            <div id="results"></div>
        </div>

        <script type="module" type="text/javascript">
            import { OramaClient } from './out.js';
            
            const endpoint = document.getElementById('endpoint');
            const apikey = document.getElementById('apikey');
            const create = document.getElementById('create');
            const instance = document.getElementById('instance');
            const withcache = document.getElementById('withcache');
            const withtelemetry = document.getElementById('withtelemetry');
            const withheartbeat = document.getElementById('withheartbeat');

            let orama = undefined;
            create.addEventListener('click', e => {
                orama = new OramaClient({
                    api_key: apikey.value,
                    endpoint: endpoint.value,
                    telemetry: withtelemetry.checked ? { } : false,
                    cache: withcache.checked ? { } : false,
                })
                if (withheartbeat.checked) {
                    orama.startHeartBeat({
                        frequency: 5000,
                    })
                }
                instance.style.display = 'block';
            })

            const term = document.getElementById('term');
            const resultsDiv = document.getElementById('results');

            term.addEventListener('input', async () => {
                resultsDiv.innerHTML = '';

                console.log('searching...')
                const result = await orama.search({
                    term: term.value
                })
                console.log('searched', result)

                const { hits, count, elapsed } = result

                console.log('result', result);

                resultsDiv.innerHTML = `
                    <div>Found ${count} results in ${elapsed.formatted}</div>
                    <ul>
                        ${hits.map(hit => `
                            <li>
                                <p>${hit.id} - ${hit.score}</p>
                                <pre>${JSON.stringify(hit.document)}</pre>
                            </li>
                        `).join('')}
                    </ul>

`


            })

            
        </script>
    </body>
</html>